<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini Fortnite 2D</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden; background: #4e8cff;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #7ec850;
    border: 2px solid #333;
  }
  #info {
    position: fixed;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    font-family: Arial, sans-serif;
    background: rgba(255,255,255,0.8);
    padding: 5px 10px;
    border-radius: 5px;
    user-select: none;
  }
</style>
</head>
<body>

<div id="info">Use WASD to move, mouse to aim and shoot. Survive inside the shrinking safe zone!</div>
<canvas id="game" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  radius: 15,
  speed: 3,
  color: 'blue',
  health: 100,
  angle: 0,
};

const bullets = [];
const enemies = [];
const keys = {};

const safeZone = {
  x: 100,
  y: 100,
  width: 600,
  height: 400,
  shrinkRate: 0.05,
  minSize: 100,
};

function spawnEnemy() {
  const enemy = {
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    radius: 12,
    speed: 1.5,
    color: 'red',
    health: 30,
  };
  enemies.push(enemy);
}

for (let i = 0; i < 5; i++) {
  spawnEnemy();
}

// Input Handling
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  player.angle = Math.atan2(mouseY - player.y, mouseX - player.x);
});

canvas.addEventListener('click', e => {
  // Shoot bullet
  bullets.push({
    x: player.x + Math.cos(player.angle) * player.radius,
    y: player.y + Math.sin(player.angle) * player.radius,
    radius: 5,
    speed: 7,
    dx: Math.cos(player.angle) * 7,
    dy: Math.sin(player.angle) * 7,
    color: 'black',
  });
});

function update() {
  // Move player
  if (keys['w'] && player.y - player.radius > 0) player.y -= player.speed;
  if (keys['s'] && player.y + player.radius < canvas.height) player.y += player.speed;
  if (keys['a'] && player.x - player.radius > 0) player.x -= player.speed;
  if (keys['d'] && player.x + player.radius < canvas.width) player.x += player.speed;

  // Update bullets
  for (let i = bullets.length - 1; i >= 0; i--) {
    const b = bullets[i];
    b.x += b.dx;
    b.y += b.dy;

    // Remove bullets off screen
    if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
      bullets.splice(i, 1);
      continue;
    }

    // Check collision with enemies
    for (let j = enemies.length - 1; j >= 0; j--) {
      const e = enemies[j];
      const dist = Math.hypot(b.x - e.x, b.y - e.y);
      if (dist < b.radius + e.radius) {
        e.health -= 20;
        bullets.splice(i, 1);
        if (e.health <= 0) {
          enemies.splice(j, 1);
          spawnEnemy();
        }
        break;
      }
    }
  }

  // Move enemies toward player
  enemies.forEach(e => {
    const angle = Math.atan2(player.y - e.y, player.x - e.x);
    e.x += Math.cos(angle) * e.speed;
    e.y += Math.sin(angle) * e.speed;

    // Enemy damage player on collision
    const dist = Math.hypot(e.x - player.x, e.y - player.y);
    if (dist < e.radius + player.radius) {
      player.health -= 0.5;
      if (player.health < 0) player.health = 0;
    }
  });

  // Shrink safe zone
  if (safeZone.width > safeZone.minSize) {
    safeZone.x += safeZone.shrinkRate;
    safeZone.y += safeZone.shrinkRate;
    safeZone.width -= safeZone.shrinkRate * 2;
    safeZone.height -= safeZone.shrinkRate * 2;
  }

  // Damage player if outside safe zone
  if (
    player.x < safeZone.x || player.x > safeZone.x + safeZone.width ||
    player.y < safeZone.y || player.y > safeZone.y + safeZone.height
  ) {
    player.health -= 0.3;
    if (player.health < 0) player.health = 0;
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw safe zone
  ctx.strokeStyle = 'rgba(0, 255, 255, 0.7)';
  ctx.lineWidth = 4;
  ctx.strokeRect(safeZone.x, safeZone.y, safeZone.width, safeZone.height);

  // Draw player
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fill();

  // Draw player gun direction
  ctx.strokeStyle = 'black';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(player.x, player.y);
  ctx.lineTo(player.x + Math.cos(player.angle) * player.radius * 2, player.y + Math.sin(player.angle) * player.radius * 2);
  ctx.stroke();

  // Draw bullets
  bullets.forEach(b => {
    ctx.fillStyle = b.color;
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
    ctx.fill();
  });

  // Draw enemies
  enemies.forEach(e => {
    ctx.fillStyle = e.color;
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
    ctx.fill();
  });

  // Draw player health
  ctx.fillStyle = 'red';
  ctx.fillRect(20, 20, player.health * 2, 20);
  ctx.strokeStyle = 'black';
  ctx.strokeRect(20, 20, 200, 20);

  // Health text
  ctx.fillStyle = 'black';
  ctx.font = '16px Arial';
  ctx.fillText('Health', 20, 15);
}

function gameLoop() {
  update();
  draw();

  if (player.health <= 0) {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'white';
    ctx.font = '48px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2);
  } else {
    requestAnimationFrame(gameLoop);
  }
}

gameLoop();
</script>

</body>
</html>
